<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>A simple way to collaborate with Python developers that do not use Emacs</title><meta content="<p>In this post I'll share some tips to make it easier to setup a
collaborative (Unix-based) Python development environment.</p>
" name=description><link href=/img/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/img/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/img/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://fonts.googleapis.com rel=preconnect><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel=stylesheet><link href=/main.css rel=stylesheet><body class=post><script>if(localStorage.getItem('theme')=='dark')document.body.classList.add('dark')</script><header class=blur><div id=wrapper><nav><a href=/>dariofad</a><span class=separator>-</span><a href=https://dariofad.github.io/blog/>blog</a></nav><div id=btns><a aria-label="rss feed" href=/blog/feed.xml><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M3 17C5.20914 17 7 18.7909 7 21H3V17ZM3 10C9.07513 10 14 14.9249 14 21H12C12 16.0294 7.97056 12 3 12V10ZM3 3C12.9411 3 21 11.0589 21 21H19C19 12.1634 11.8366 5 3 5V3Z" fill=currentColor></path></svg></a><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill="currentColor"></path></svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z" fill="currentColor"></path></svg>' id=theme-toggle><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill=currentColor></path></svg></button><button aria-label="table of content" id=toc-toggle><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M3 4H21V6H3V4ZM3 11H15V13H3V11ZM3 18H21V20H3V18Z" fill=currentColor></path></svg></button></div></div></header><div id=post-wrapper><div id=blank></div><main><div id=top></div><article><h1>A simple way to collaborate with Python developers that do not use Emacs</h1><div id=post-info><div id=date><span id=publish>2021-02-28</span></div><div id=tags><a href=https://dariofad.github.io//tags/emacs># emacs</a><a href=https://dariofad.github.io//tags/vscode># vscode</a><a href=https://dariofad.github.io//tags/python># python</a><a href=https://dariofad.github.io//tags/development># development</a><a href=https://dariofad.github.io//tags/linux># linux</a></div></div><p>In this post I'll share some tips to make it easier to setup a collaborative (Unix-based) Python development environment.</p><span id=continue-reading></span><p>The more you use Emacs, the more you feel uncomfortable when you have to write something outside it. This is even more true when writing code. Some months ago I switched to <code>lsp-mode</code>, a client for the Language Server Protocol that aims to provide IDE-like experience in Emacs. To me, using <code>lsp-mode</code> has several advantages, including the ability to quickly write, test and debug small snippets of code without even touching the mouse.<p>However, I recognize that anyone has its favourite IDE when it comes to writing code. I also understand that maybe using Emacs is not a priority to all of us. As an example, the favourite IDE of some of my colleagues happens to be Visual Studio Code. To stay productive, we need to be able to develop in the same environment using different (and potentially conflicting) setups.<h2 id=the-typical-environment>The typical environment<a aria-label="Anchor link for: the-typical-environment" class=zola-anchor href=#the-typical-environment>#</a></h2><p>Python is a very appealing solution when software needs to be developed rapidly and there are no particular hardware requirements or constraints. Complex operations can be done concisely, and there are libraries for pretty much anything. To use a function that is not provided by the standard library, we just need to install an external package running <code>pip install pkg_name</code> and then we are ready to go.<p>To keep the system clean, and to avoid dependency conflicts between multiple projects, <em>virtual environments</em> are used. Each virtual environment (or simply <em>venv</em>) is a directory tree that contains a Python installation, plus a number of additional packages. To create a venv, it is only required to type in the terminal the command <code>python -m venv venv_name</code>. To use it instead of the global Python installation, its enough to enter it and source the terminal with the command <code>source bin/activate</code>.<p>Virtual environments are the key to make sure that each Python project is self contained, but sometimes a project relies on a number of external dependencies or binaries that need to be available system-wide. To accomodate for this, several build systems can be used. One of the most common is <strong>GNU make</strong>. <code>make</code> is relevant for a number of historical reasons, but most importantly, it fits nicely in a Unix environment, as it can be used to run directly shell commands. Many large projects use it extensively, as it enables an end user to build and install a package without knowing the details of how that is done.<p>In our typical development environment we use <code>make</code> to setup, build, execute and test most of the projects. However, we do not use the same set of tools to code. The ones using VS Code can take advantage of utils and extensions it provides to set current Python venv and use the makefiles, while Emacs users need some additional configuration. This is not really an issue, however, we have to ensure <strong>the additional configuration files introduced in the repository don't cause conflicts to each other</strong> (i.e., Emacs configuration files must be transparent to VS Code and viceversa).<h2 id=emacs-lsp-mode-venvs>Emacs, lsp-mode, venvs<a aria-label="Anchor link for: emacs-lsp-mode-venvs" class=zola-anchor href=#emacs-lsp-mode-venvs>#</a></h2><p>Before going into the details of the setup, I'll talk a little bit about how Emacs can be transformed into an IDE using <code>lsp-mode</code>, touching only the key points. If you already know how to setup an Emacs IDE, the following can be skipped.<p>To act as an IDE, Emacs needs some extensions. There are many packages that can be used to do that; I use <code>lsp-mode</code>. At high level, it is a client able to interact with a backend server via asynchronous calls using the Language Server Procol. The idea is that we can support many different languages by simply replacing the backend server, and thus have a configuration that is not language-specific. This basically means we have to provide a server to Emacs whenever a Python source file in our project is read into a buffer. Anyway, unlike a traditional IDE, Emacs by itself is not aware of what a project is, and thus we have to send it some updates each time we open, close or switch to project-related file. If you think about it, IDEs like VS Code or IntelliJ are built on the concept of project, to which they usually assign the whole window. A good way to address this problem is to use environment variables, which are accessible to Emacs through the <code>getenv</code> function. To cut a long story short, I do this using <code>direnv</code>. This allows me to automatically load/unload some environment variables each time I open a file, kill or switch to a buffer.<p>In its simplicity, <code>direnv</code> is a fantastic tool. It offers many standard library function, including some to configure and activate a Python layout. <code>direnv</code> checks for the existence of an <code>.envrc</code> file inside the root project directory each time the directory is opened, and if the file exists, it is loaded and all the environment exported variables are made available to the current shell. The key point is that this happens only if the <code>.envrc</code> file is authorized by the user.<h2 id=project-setup>Project setup<a aria-label="Anchor link for: project-setup" class=zola-anchor href=#project-setup>#</a></h2><p>The idea is that Emacs and non-Emacs users can use two slightly different configurations for the same Python project:<ul><li>Emacs users rely on <code>direnv</code> to setup the local development environment, and use the <code>make</code> build system for anything else;<li>non-Emacs users solely rely on the <code>make</code> build system.</ul><p>The first necessity is that both configurations target the same virtual environment.<p>To create a venv with <code>direnv</code>, the Emacs user is required to create the <code>.envrc</code> file (in the root project directory), and add <code>layout python python3</code> as the first line. Running the command <code>direnv allow</code> immediately causes the <code>.envrc</code> file to be loaded, and the Python3 layout to be created. The venv is by default created in the <code>.direnv/python-$(VERSION)</code> folder, and activated each time the root project directory is opened.<p>Non-Emacs user create the venv using a Makefile rule. We only need to ensure the venv path matches the default one used by direnv. To do that, we declare in the makefile the variable <code>VENVNAME := $(subst P,p,$(subst $(space),-,$(shell python3 --version)))</code>, where <code>space</code> is the literal <code>$() $()</code>. To create the venv, the non-Emacs user can run the recipe <code>install</code>, defined as:<pre class=language-make data-lang=make style=background:#2b303b;color:#6c7079><code class=language-make data-lang=make><span style=color:#5cb3fa>install</span><span style=color:#adb7c9>:
</span><span style=color:#abb2bf>	</span><span style=color:#eb6772>test -d </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>) </span><span style=color:#adb7c9>|| </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VIRTUALENV</span><span style=color:#cd74e8>) $(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)
</span></code></pre><p>where <code>VIRTUALENV</code> is defined as <code>VIRTUALENV := python3 -m venv .direnv/$(VENVNAME) </code><h2 id=python-app>Python app<a aria-label="Anchor link for: python-app" class=zola-anchor href=#python-app>#</a></h2><p>At this point both the Emacs and non-Emacs users are working in the same venv. The only difference we have to keep in mind is that the Emacs user's venv is activated by default.<p>Now we have to provide a method to install Python requirements. To avoid confusion, the <code>install</code> rule can be reused, adding to the recipe the required steps:<pre class=language-make data-lang=make style=background:#2b303b;color:#6c7079><code class=language-make data-lang=make><span style=color:#5cb3fa>install</span><span style=color:#adb7c9>: </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>REQUIREMENTS</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#eb6772>test -d </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>) </span><span style=color:#adb7c9>|| </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VIRTUALENV</span><span style=color:#cd74e8>) $(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PIP</span><span style=color:#cd74e8>) </span><span style=color:#eb6772>$@ --upgrade</span><span style=color:#abb2bf> pip
</span><span style=color:#abb2bf>	</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PIP</span><span style=color:#cd74e8>) </span><span style=color:#eb6772>$@ -r $<
</span></code></pre><p>where <code>REQUIREMENTS</code> is the file <code>$ROOT_DIR/requirements.txt</code>. Running <code>make install</code> doesn't cause any problem to the Emacs user since there is no modification to the Python executable path.<p>To run the application we provide the <code>run</code> recipe, which has <code>install</code> as a prerequisite (if requirements.txt is updated then the newly introduced requirements will automatically be installed each time the app is executed).<pre class=language-make data-lang=make style=background:#2b303b;color:#6c7079><code class=language-make data-lang=make><span style=color:#5cb3fa>run</span><span style=color:#adb7c9>: </span><span style=color:#9acc76>install
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#5ebfcc>echo </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PYTHON</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PYTHON</span><span style=color:#cd74e8>) $(</span><span style=color:#eb6772>APP</span><span style=color:#cd74e8>)
</span></code></pre><p><code>APP</code> is defined as <code>APP := app_launcher.py</code>.<p>As a final step, we can provide a rule to clean the venv when needed. This is done by <code>clean</code>, defined as:<pre class=language-make data-lang=make style=background:#2b303b;color:#6c7079><code class=language-make data-lang=make><span style=color:#5cb3fa>clean</span><span style=color:#adb7c9>:
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>rm -rf </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>find</span><span style=color:#abb2bf> .</span><span style=color:#eb6772> -path </span><span style=color:#9acc76>'*/__pycache__/*'</span><span style=color:#eb6772> -delete
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>find</span><span style=color:#abb2bf> .</span><span style=color:#eb6772> -type</span><span style=color:#abb2bf> d</span><span style=color:#eb6772> -name </span><span style=color:#9acc76>'__pycache__'</span><span style=color:#eb6772> -delete
</span></code></pre><h2 id=system-wide-dependencies>System-wide dependencies<a aria-label="Anchor link for: system-wide-dependencies" class=zola-anchor href=#system-wide-dependencies>#</a></h2><p>Usually a project relies on some libraries or binaries that need to be available system-wide. However, I try to keep my system as close to a vanilla distribution as much as I can, trying to avoid the dependency hell. What I typically do is install all the required binaries in the directory <code>$ROOT_DIR/bin</code>, which is then added to the <code>$PATH</code> environment variable. This can be done easily using <code>direnv</code> with <code>PATH_add</code>, a function that prepends an input path to the <code>PATH</code> environment variable. This is really a killer feature, as <code>direnv</code> not only adds the input path when the project is opened, but it also removes it when the project is closed, keeping my global <code>PATH</code> clean.<p>Anyway, I recommend to install software dependencies using Makefile rules. It is a bad practice to use <code>direnv</code> to perform time consuming operations. Not only if <code>direnv</code> takes too much Emacs may hang, but also other programs might crash (e.g., git might crash if different commands are executed simultaneously, causing the local content to be corrupted). Therefore, I use <code>direnv</code> only to create the project directory structure, add paths to the global environment, and check if a software dependency is available (sending a message to the user otherwise). This is done using the function <code>has</code>, as detailed in the following:<pre class=language-bash data-lang=bash style=background:#2b303b;color:#6c7079><code class=language-bash data-lang=bash><span style=font-style:italic;color:#5f697a># add bin to path
</span><span style=color:#eb6772>PATH_add</span><span style=color:#abb2bf>  bin
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># required dependencies
</span><span style=color:#eb6772>binary_deps</span><span style=color:#adb7c9>+=</span><span style=color:#abb2bf>( </span><span style=color:#9acc76>"dep1" "dep2" "dep3"</span><span style=color:#abb2bf>)
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># warn the user if a dependency is missing
</span><span style=color:#cd74e8>for</span><span style=color:#abb2bf> dep </span><span style=color:#cd74e8>in </span><span style=color:#abb2bf>${</span><span style=color:#eb6772>binary_deps[@]</span><span style=color:#abb2bf>}</span><span style=color:#adb7c9>; </span><span style=color:#cd74e8>do
</span><span style=color:#abb2bf>    </span><span style=color:#cd74e8>if </span><span style=color:#adb7c9>! </span><span style=color:#eb6772>has </span><span style=color:#abb2bf>$</span><span style=color:#eb6772>dep</span><span style=color:#adb7c9>; </span><span style=color:#cd74e8>then
</span><span style=color:#abb2bf>	</span><span style=color:#5ebfcc>echo </span><span style=color:#9acc76>"missing dependency '${</span><span style=color:#eb6772>dep</span><span style=color:#9acc76>}', to install it run 'make install_binaries'"
</span><span style=color:#abb2bf>    </span><span style=color:#cd74e8>fi
</span><span style=color:#cd74e8>done
</span><span style=color:#abb2bf>
</span></code></pre><p>Non-Emacs users can export <code>bin</code> to the global path adding to the Makefile the following line.<pre class=language-bash data-lang=bash style=background:#2b303b;color:#6c7079><code class=language-bash data-lang=bash><span style=color:#cd74e8>export </span><span style=color:#eb6772>PATH </span><span style=color:#adb7c9>= </span><span style=color:#abb2bf>$(</span><span style=color:#eb6772>shell</span><span style=color:#abb2bf> printenv PATH)</span><span style=color:#eb6772>:$</span><span style=color:#abb2bf>(ROOT_DIR)</span><span style=color:#eb6772>/$</span><span style=color:#abb2bf>(LOCAL_BINARIES)
</span></code></pre><p>The last change won't affect <code>direnv</code> users, as it only adds a duplicate to the PATH. There also other solutions (e.g., exploiting the functionality provided by the dynamic linker), but this is the most straightforward to me.<h2 id=envrc>.envrc<a aria-label="Anchor link for: envrc" class=zola-anchor href=#envrc>#</a></h2><p>The final version of the <code>.envrc</code> file.<pre class=language-bash data-lang=bash style=background:#2b303b;color:#6c7079><code class=language-bash data-lang=bash><span style=font-style:italic;color:#5f697a># create a python3 layout
</span><span style=color:#eb6772>layout</span><span style=color:#abb2bf> python python3
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># create directory to store the local binaries and add it to the path
</span><span style=color:#eb6772>mkdir -p</span><span style=color:#abb2bf> bin
</span><span style=color:#eb6772>PATH_add</span><span style=color:#abb2bf>  bin
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># required dependencies
</span><span style=color:#eb6772>binary_deps</span><span style=color:#adb7c9>+=</span><span style=color:#abb2bf>( </span><span style=color:#9acc76>"dep1" "dep2" "dep3"</span><span style=color:#abb2bf>)
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># warn the user if a dependency is missing
</span><span style=color:#cd74e8>for</span><span style=color:#abb2bf> dep </span><span style=color:#cd74e8>in </span><span style=color:#abb2bf>${</span><span style=color:#eb6772>binary_deps[@]</span><span style=color:#abb2bf>}</span><span style=color:#adb7c9>; </span><span style=color:#cd74e8>do
</span><span style=color:#abb2bf>    </span><span style=color:#cd74e8>if </span><span style=color:#adb7c9>! </span><span style=color:#eb6772>has </span><span style=color:#abb2bf>$</span><span style=color:#eb6772>dep</span><span style=color:#adb7c9>; </span><span style=color:#cd74e8>then
</span><span style=color:#abb2bf>	</span><span style=font-style:italic;color:#5f697a># (do not use the .envrc to install binaries, use Makefile instead...
</span><span style=color:#abb2bf>	</span><span style=font-style:italic;color:#5f697a>#  ... if the .envrc blocks, other tools might hang or break, e.g. emacs or git)
</span><span style=color:#abb2bf>	</span><span style=color:#5ebfcc>echo </span><span style=color:#9acc76>"missing dependency '${</span><span style=color:#eb6772>dep</span><span style=color:#9acc76>}', to install it run 'make install_binaries'"	
</span><span style=color:#abb2bf>    </span><span style=color:#cd74e8>fi
</span><span style=color:#cd74e8>done
</span></code></pre><h2 id=makefile>Makefile<a aria-label="Anchor link for: makefile" class=zola-anchor href=#makefile>#</a></h2><p>The final version of the <code>Makefile</code>.<pre class=language-make data-lang=make style=background:#2b303b;color:#6c7079><code class=language-make data-lang=make><span style=color:#5cb3fa>.PHONY</span><span style=color:#adb7c9>: </span><span style=color:#9acc76>all clean remove_binaries install_binaries install run
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># literal to define whitespace
</span><span style=color:#eb6772>space</span><span style=color:#adb7c9>=</span><span style=color:#cd74e8>$() $()
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># make the venv path name matches the default name used by direnv
</span><span style=color:#eb6772>VENVNAME       </span><span style=color:#adb7c9>:= </span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>subst </span><span style=color:#9acc76>P,p,</span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>subst </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>space</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>,-,</span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>shell </span><span style=color:#eb6772>python3 --version</span><span style=color:#cd74e8>)))
</span><span style=color:#eb6772>VIRTUALENV     </span><span style=color:#adb7c9>:= </span><span style=color:#9acc76>python3 -m venv .direnv/</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENVNAME</span><span style=color:#cd74e8>)
</span><span style=color:#eb6772>ROOT_DIR       </span><span style=color:#adb7c9>:= </span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>shell </span><span style=color:#eb6772>dirname </span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>realpath </span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>firstword </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>MAKEFILE_LIST</span><span style=color:#cd74e8>))))
</span><span style=color:#eb6772>VENV           </span><span style=color:#adb7c9>:= </span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>strip </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>ROOT_DIR</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>/.direnv/</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENVNAME</span><span style=color:#cd74e8>))
</span><span style=color:#eb6772>ACTIVATE       </span><span style=color:#adb7c9>:= </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>/bin/activate
</span><span style=color:#eb6772>PYTHON         </span><span style=color:#adb7c9>:= </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>/bin/python
</span><span style=color:#eb6772>PIP            </span><span style=color:#adb7c9>:= </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PYTHON</span><span style=color:#cd74e8>)</span><span style=color:#9acc76> -m pip
</span><span style=color:#abb2bf>
</span><span style=color:#eb6772>SHELL          </span><span style=color:#adb7c9>:= </span><span style=color:#9acc76>/bin/bash
</span><span style=color:#abb2bf>
</span><span style=color:#eb6772>LOCAL_BINARIES </span><span style=color:#adb7c9>:= </span><span style=color:#9acc76>bin
</span><span style=color:#abb2bf>
</span><span style=color:#eb6772>REQUIREMENTS   </span><span style=color:#adb7c9>:= </span><span style=color:#9acc76>requirements.txt      </span><span style=font-style:italic;color:#5f697a># insert here your python requirements
</span><span style=color:#eb6772>APP            </span><span style=color:#adb7c9>:= </span><span style=color:#9acc76>app_launcher.py	</span><span style=font-style:italic;color:#5f697a># this file is used as the main app driver
</span><span style=color:#abb2bf>
</span><span style=font-style:italic;color:#5f697a># add ./bin to the path
</span><span style=color:#cd74e8>export</span><span style=color:#eb6772> PATH </span><span style=color:#adb7c9>= </span><span style=color:#cd74e8>$(</span><span style=color:#5ebfcc>shell </span><span style=color:#eb6772>printenv</span><span style=color:#abb2bf> PATH</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>:</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>ROOT_DIR</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>/</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>LOCAL_BINARIES</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>
</span><span style=color:#5cb3fa>all</span><span style=color:#adb7c9>: </span><span style=color:#9acc76>run				</span><span style=font-style:italic;color:#5f697a># install python deps run the project
</span><span style=color:#abb2bf>
</span><span style=color:#5cb3fa>clean</span><span style=color:#adb7c9>:					</span><span style=font-style:italic;color:#5f697a># clean python dependencies
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>rm -rf </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>find</span><span style=color:#abb2bf> .</span><span style=color:#eb6772> -path </span><span style=color:#9acc76>'*/__pycache__/*'</span><span style=color:#eb6772> -delete
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>find</span><span style=color:#abb2bf> .</span><span style=color:#eb6772> -type</span><span style=color:#abb2bf> d</span><span style=color:#eb6772> -name </span><span style=color:#9acc76>'__pycache__'</span><span style=color:#eb6772> -delete
</span><span style=color:#abb2bf>
</span><span style=color:#5cb3fa>remove_binaries</span><span style=color:#adb7c9>:			</span><span style=font-style:italic;color:#5f697a># remove local binaries
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>rm -rf </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>LOCAL_BINARIES</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>
</span><span style=color:#5cb3fa>install_binaries</span><span style=color:#adb7c9>:			</span><span style=font-style:italic;color:#5f697a># use this rule to install local binaries in ./bin
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#eb6772>mkdir -p </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>ROOT_DIR</span><span style=color:#cd74e8>)</span><span style=color:#abb2bf>/</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>LOCAL_BINARIES</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#5ebfcc>echo </span><span style=color:#9acc76>"Installing required binaries locally..."
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#5ebfcc>echo </span><span style=color:#9acc76>"...DONE"
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#5ebfcc>echo </span><span style=color:#9acc76>"Remember to ADD </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>ROOT_DIR</span><span style=color:#cd74e8>)</span><span style=color:#9acc76>/bin to the current PATH" </span><span style=color:#abb2bf>\
</span><span style=color:#abb2bf>		</span><span style=color:#9acc76>"**ONLY if you are NOT USING direnv**." </span><span style=color:#abb2bf>\
</span><span style=color:#abb2bf>		</span><span style=color:#9acc76>"To do that run 'make export_path'"
</span><span style=color:#abb2bf>
</span><span style=color:#5cb3fa>install</span><span style=color:#adb7c9>: </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>REQUIREMENTS</span><span style=color:#cd74e8>)		</span><span style=font-style:italic;color:#5f697a># install python venv (with all required packages)
</span><span style=color:#abb2bf>	</span><span style=color:#eb6772>test -d </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>) </span><span style=color:#adb7c9>|| </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>VIRTUALENV</span><span style=color:#cd74e8>) $(</span><span style=color:#eb6772>VENV</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PIP</span><span style=color:#cd74e8>) </span><span style=color:#eb6772>$@ --upgrade</span><span style=color:#abb2bf> pip
</span><span style=color:#abb2bf>	</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PIP</span><span style=color:#cd74e8>) </span><span style=color:#eb6772>$@ -r $<
</span><span style=color:#abb2bf>
</span><span style=color:#5cb3fa>run</span><span style=color:#adb7c9>: </span><span style=color:#9acc76>install 				</span><span style=font-style:italic;color:#5f697a># run project
</span><span style=color:#abb2bf>	</span><span style=color:#db9d63>@ </span><span style=color:#5ebfcc>echo </span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PYTHON</span><span style=color:#cd74e8>)
</span><span style=color:#abb2bf>	</span><span style=color:#cd74e8>$(</span><span style=color:#eb6772>PYTHON</span><span style=color:#cd74e8>) $(</span><span style=color:#eb6772>APP</span><span style=color:#cd74e8>)
</span></code></pre></article><footer><div class=copyright><p>Â© 2023 Dario Facchinetti</div></footer></main><aside class=blur><nav><ul><li><a href=#the-typical-environment>The typical environment</a><li><a href=#emacs-lsp-mode-venvs>Emacs, lsp-mode, venvs</a><li><a href=#project-setup>Project setup</a><li><a href=#python-app>Python app</a><li><a href=#system-wide-dependencies>System-wide dependencies</a><li><a href=#envrc>.envrc</a><li><a href=#makefile>Makefile</a></ul></nav></aside></div><script src=/js/lightense.min.js></script><script src=/js/main.js></script>